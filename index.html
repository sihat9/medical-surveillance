<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Surveillance System</title>
    <link rel="stylesheet" href="style.css">
    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- SheetJS untuk Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <h1>üè• MEDICAL SURVEILLANCE SYSTEM</h1>
                <p>Sistem Pengurusan Borang USECHH Digital</p>
            </div>
            
            <div class="login-form">
                <div class="form-group">
                    <label for="userRole">Peranan:</label>
                    <select id="userRole" onchange="showRoleFields()">
                        <option value="">Pilih Peranan</option>
                        <option value="admin">Admin</option>
                        <option value="doctor">Doktor</option>
                        <option value="ma">Medical Assistant</option>
                    </select>
                </div>

                <div id="adminFields" class="role-fields">
                    <div class="form-group">
                        <label for="adminName">Nama Admin:</label>
                        <input type="text" id="adminName" placeholder="Nama admin">
                    </div>
                </div>

                <div id="doctorFields" class="role-fields">
                    <div class="form-group">
                        <label for="doctorId">ID Doktor:</label>
                        <input type="text" id="doctorId" placeholder="DR001">
                    </div>
                </div>

                <div id="maFields" class="role-fields">
                    <div class="form-group">
                        <label for="maId">ID MA:</label>
                        <input type="text" id="maId" placeholder="MA001">
                    </div>
                </div>
                
                <button onclick="login()" class="btn-primary">LOGIN</button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="screen">
        <div class="dashboard-header">
            <button onclick="logout()" class="btn-back">‚Üê Logout</button>
            <h2>üë®‚Äçüíº ADMIN DASHBOARD</h2>
            <span id="adminWelcome"></span>
        </div>

        <div class="dashboard-content">
            <!-- Upload Section -->
            <div class="upload-section">
                <h3>üì§ Muat Naik Senarai Pekerja</h3>
                <div class="upload-box">
                    <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" onchange="previewExcel()">
                    <label for="excelFile" class="upload-label">
                        üìé Pilih File Excel
                    </label>
                    <div id="filePreview"></div>
                    <button onclick="uploadWorkers()" class="btn-primary" id="uploadBtn" disabled>Muat Naik</button>
                </div>
            </div>

            <!-- Company List -->
            <div class="company-section">
                <h3>üè¢ Senarai Syarikat</h3>
                <div id="companyList" class="company-grid">
                    <!-- Dynamic company cards -->
                </div>
            </div>
        </div>
    </div>

    <!-- Doctor Dashboard -->
    <div id="doctorDashboard" class="screen">
        <div class="dashboard-header">
            <button onclick="logout()" class="btn-back">‚Üê Logout</button>
            <h2>üë®‚Äç‚öïÔ∏è DOKTOR DASHBOARD</h2>
            <span id="doctorWelcome"></span>
        </div>

        <div class="dashboard-content">
            <div class="filter-section">
                <input type="text" id="companySearch" placeholder="Cari syarikat..." onkeyup="filterCompanies()">
                <select id="statusFilter" onchange="filterCompanies()">
                    <option value="">Semua Status</option>
                    <option value="PENDING">Pending</option>
                    <option value="IN_PROGRESS">In Progress</option>
                    <option value="COMPLETED">Completed</option>
                </select>
            </div>

            <div id="doctorCompanyList" class="company-grid">
                <!-- Dynamic company cards for doctor -->
            </div>
        </div>
    </div>

    <!-- Worker List Screen -->
    <div id="workerListScreen" class="screen">
        <div class="dashboard-header">
            <button onclick="showScreen('doctorDashboard')" class="btn-back">‚Üê Kembali</button>
            <h2 id="workerListTitle">üë• Senarai Pekerja</h2>
        </div>

        <div class="worker-container">
            <div class="worker-table-container">
                <table class="worker-table">
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>No IC/Passport</th>
                            <th>Jantina</th>
                            <th>Status</th>
                            <th>Tindakan</th>
                        </tr>
                    </thead>
                    <tbody id="workerTableBody">
                        <!-- Dynamic worker rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- QR Signature Screen -->
    <div id="qrSignatureScreen" class="screen">
        <div class="dashboard-header">
            <button onclick="showScreen('workerListScreen')" class="btn-back">‚Üê Kembali</button>
            <h2>‚úçÔ∏è Tandatangan Digital</h2>
        </div>

        <div class="qr-container">
            <div class="qr-info">
                <h3 id="qrWorkerName"></h3>
                <p id="qrWorkerIC"></p>
            </div>
            
            <div class="qr-code-container">
                <div id="qrcode"></div>
                <p>üì± Scan QR code dengan device lain untuk tandatangan</p>
            </div>

            <div class="signature-preview">
                <h4>Tandatangan Disimpan:</h4>
                <img id="signaturePreview" src="" style="display: none; max-width: 300px; border: 1px solid #ddd;">
                <p id="noSignatureText" style="color: #999;">Belum ada tandatangan</p>
            </div>
        </div>
    </div>
<!-- MA Dashboard -->
<div id="maDashboard" class="screen">
    <div class="dashboard-header">
        <button onclick="logout()" class="btn-back">‚Üê Logout</button>
        <h2>üë®‚Äç‚öïÔ∏è MEDICAL ASSISTANT DASHBOARD</h2>
        <span id="maWelcome"></span>
    </div>

    <div class="dashboard-content">
        <div class="ma-quick-actions">
            <div class="action-card" onclick="loadMADashboard()">
                <div class="action-icon">‚ù§Ô∏è</div>
                <h3>Vital Signs</h3>
                <p>Ambil tanda vital</p>
            </div>
            <div class="action-card" onclick="openLabUpload()">
                <div class="action-icon">üìä</div>
                <h3>Lab Reports</h3>
                <p>Upload & kategori</p>
            </div>
            <div class="action-card" onclick="openTodaySchedule()">
                <div class="action-icon">üìÖ</div>
                <h3>Jadual Hari Ini</h3>
                <p>Lihat jadual</p>
            </div>
        </div>

        <div class="company-section">
            <h3>üè¢ Syarikat untuk Hari Ini</h3>
            <div id="maCompanyList" class="company-grid">
                <!-- Dynamic MA company cards -->
            </div>
        </div>
    </div>
</div>

<!-- MA Worker List Screen -->
<div id="maWorkerListScreen" class="screen">
    <div class="dashboard-header">
        <button onclick="showScreen('maDashboard')" class="btn-back">‚Üê Kembali</button>
        <h2 id="maWorkerListTitle">‚ù§Ô∏è Pemeriksaan Vital Signs</h2>
    </div>

    <div class="ma-worker-container">
        <div class="worker-list" id="maWorkerList">
            <!-- Dynamic MA worker cards -->
        </div>
    </div>
</div>

<!-- Vital Signs Form Screen -->
<div id="vitalSignsScreen" class="screen">
    <div class="dashboard-header">
        <button onclick="showScreen('maWorkerListScreen')" class="btn-back">‚Üê Kembali</button>
        <h2>‚ù§Ô∏è Vital Signs</h2>
    </div>

    <div class="vital-form-container">
        <div class="patient-info">
            <h3 id="vitalWorkerName"></h3>
            <p id="vitalWorkerIC"></p>
        </div>

        <div class="vital-form">
            <div class="form-grid">
                <div class="input-group">
                    <label for="tinggi">Tinggi (cm) *</label>
                    <input type="number" id="tinggi" step="0.1" min="100" max="250" required>
                </div>
                
                <div class="input-group">
                    <label for="berat">Berat (kg) *</label>
                    <input type="number" id="berat" step="0.1" min="30" max="200" required>
                </div>
                
                <div class="input-group">
                    <label for="tekananDarah">Tekanan Darah *</label>
                    <input type="text" id="tekananDarah" placeholder="120/80" required>
                </div>
                
                <div class="input-group">
                    <label for="suhu">Suhu Badan (¬∞C)</label>
                    <input type="number" id="suhu" step="0.1" min="35" max="42" placeholder="37.0">
                </div>
                
                <div class="input-group">
                    <label for="denyutanNadi">Denyutan Nadi (bpm)</label>
                    <input type="number" id="denyutanNadi" min="40" max="200" placeholder="72">
                </div>
                
                <div class="input-group">
                    <label for="spo2">SPO2 (%)</label>
                    <input type="number" id="spo2" min="80" max="100" placeholder="98">
                </div>
            </div>

            <div class="form-actions">
                <button onclick="saveVitalSigns()" class="btn-primary">Simpan Vital Signs</button>
            </div>
        </div>
    </div>
</div>

<!-- Lab Upload Screen -->
<div id="labUploadScreen" class="screen">
    <div class="dashboard-header">
        <button onclick="showScreen('maDashboard')" class="btn-back">‚Üê Kembali</button>
        <h2>üìä Lab Reports Management</h2>
    </div>

    <div class="lab-container">
        <div class="lab-worker-list" id="labWorkerList">
            <!-- Dynamic lab worker cards -->
        </div>
    </div>
</div>

<!-- Lab Remarks Screen -->
<div id="labRemarksScreen" class="screen">
    <div class="dashboard-header">
        <button onclick="showScreen('labUploadScreen')" class="btn-back">‚Üê Kembali</button>
        <h2>üìù Lab Remarks & Kategori</h2>
    </div>

    <div class="lab-remarks-container">
        <div class="patient-info">
            <h3 id="labRemarksWorker"></h3>
        </div>

        <div class="upload-section">
            <h4>Upload PDF Lab Report</h4>
            <input type="file" id="labPdfFile" accept=".pdf">
            <button onclick="uploadLabPDF()" class="btn-secondary">Upload PDF</button>
            
            <div id="pdfPreview" class="pdf-preview">
                <!-- PDF preview will appear here -->
            </div>
        </div>

        <div class="remarks-section">
            <h4>Kategori & Remarks</h4>
            
            <div class="form-group">
                <label for="labCategory">Kategori *</label>
                <select id="labCategory" required>
                    <option value="">Pilih Kategori</option>
                    <option value="ABNORMAL_OHD">Abnormal (OHD)</option>
                    <option value="ABNORMAL_MEDICAL">Abnormal (Medical)</option>
                    <option value="TIDAK_PASTI">Tidak Pasti</option>
                    <option value="NORMAL">Normal</option>
                </select>
            </div>

            <div class="form-group">
                <label for="labRemarks">Remarks & Nota</label>
                <textarea id="labRemarks" rows="4" placeholder="Catatan abnormal, pemerhatian khas..."></textarea>
            </div>

            <button onclick="saveLabRemarks()" class="btn-primary">Simpan Remarks</button>
        </div>
    </div>
</div>
    <!-- Include other script files -->
    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/doctor.js"></script>
    <script src="js/qr-signature.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
